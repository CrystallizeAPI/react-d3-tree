!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-lifecycles-compat"),require("prop-types"),require("d3"),require("clone"),require("deep-equal"),require("uuid"),require("react-transition-group")):"function"==typeof define&&define.amd?define(["exports","react","react-lifecycles-compat","prop-types","d3","clone","deep-equal","uuid","react-transition-group"],t):t((e=e||self).reactD3Tree={},e.react,e.reactLifecyclesCompat,e.propTypes,e.d3,e.clone,e.deepEqual,e.uuid,e.reactTransitionGroup)}(this,function(e,t,n,o,r,a,i,s,l){function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s;var p=function(e){return e.transitionDuration>0?t.createElement(l.TransitionGroup,{component:e.component,className:e.className,transform:e.transform},e.children):t.createElement("g",{className:e.className,transform:e.transform},e.children)};p.defaultProps={component:"g"},p.propTypes={transitionDuration:o.number.isRequired,component:o.string,className:o.string.isRequired,transform:o.string.isRequired,children:o.array.isRequired};var d=function(e){function n(){return e.apply(this,arguments)||this}return u(n,e),n.prototype.render=function(){var e=this.props,n=e.nodeStyle,o=e.textLayout,r=e.attributes;return t.createElement("g",null,t.createElement("text",{className:"nodeNameBase",style:n.name,textAnchor:o.textAnchor,x:o.x,y:o.y,transform:o.transform,dy:".35em"},e.name),t.createElement("text",{className:"nodeAttributesBase",y:o.y+10,textAnchor:o.textAnchor,transform:o.transform,style:n.attributes},r&&Object.keys(r).map(function(e){return t.createElement("tspan",{x:o.x,dy:"1.2em",key:s.v4()},e,": ",r[e])})))},n}(t.PureComponent);d.defaultProps={attributes:void 0},d.propTypes={name:o.string.isRequired,attributes:o.object,textLayout:o.object.isRequired,nodeStyle:o.object.isRequired};var h=function(e){function n(){return e.apply(this,arguments)||this}return u(n,e),n.prototype.render=function(){var e=this.props,n=e.nodeData,o=e.nodeSize,r=e.render;return t.createElement("foreignObject",c({width:o.x-24,height:o.y-24},e.foreignObjectWrapper),t.cloneElement(r,{nodeData:n}))},n}(t.PureComponent);h.defaultProps={foreignObjectWrapper:{}},h.propTypes={render:o.oneOfType([o.element,o.node]).isRequired,nodeData:o.object.isRequired,nodeSize:o.shape({x:o.number,y:o.number}).isRequired,foreignObjectWrapper:o.object};var f=function(e){function n(){for(var n,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(n=e.call.apply(e,[this].concat(r))||this).state={transform:n.setTransform(n.props.nodeData,n.props.orientation,!0),initialStyle:{opacity:0}},n.shouldNodeTransform=function(e,t){return t.subscriptions!==e.subscriptions||t.nodeData.x!==e.nodeData.x||t.nodeData.y!==e.nodeData.y||t.orientation!==e.orientation},n.renderNodeElement=function(e){var o=n.props,r=o.circleRadius,a=o.nodeSvgShape;return r?t.createElement("circle",{r:r,style:e.circle}):"none"===a.shape?null:t.createElement(a.shape,c({},e.circle,a.shapeProps))},n.handleOnClick=function(e){n.props.onClick(n.props.nodeData.id,e)},n.handleOnMouseOver=function(e){n.props.onMouseOver(n.props.nodeData.id,e)},n.handleOnMouseOut=function(e){n.props.onMouseOut(n.props.nodeData.id,e)},n}u(n,e);var o=n.prototype;return o.componentDidMount=function(){this.commitTransform()},o.componentDidUpdate=function(){this.commitTransform()},o.shouldComponentUpdate=function(e){return this.shouldNodeTransform(this.props,e)},o.setTransform=function(e,t,n){void 0===n&&(n=!1);var o=e.x,r=e.y,a=e.parent;if(n){var i="object"==typeof a,s=i?a.x:0,l=i?a.y:0;return"horizontal"===t?"translate("+l+","+s+")":"translate("+s+","+l+")"}return"horizontal"===t?"translate("+r+","+o+")":"translate("+o+","+r+")"},o.applyTransform=function(e,t,n,o){void 0===n&&(n=1),void 0===o&&(o=function(){}),0===t?(r.select(this.node).attr("transform",e).style("opacity",n),o()):r.select(this.node).transition().duration(t).attr("transform",e).style("opacity",n).each("end",o)},o.commitTransform=function(){var e=this.props,t=e.transitionDuration,n=this.setTransform(e.nodeData,e.orientation);this.applyTransform(n,t)},o.componentWillLeave=function(e){var t=this.props,n=t.transitionDuration,o=this.setTransform(t.nodeData,t.orientation,!0);this.applyTransform(o,n,0,e)},o.render=function(){var e=this,n=this.props,o=n.nodeData,r=n.nodeSize,a=n.nodeLabelComponent,i=n.allowForeignObjects,s=n.styles,l=c({},o._children?s.node:s.leafNode);return t.createElement("g",{id:o.id,ref:function(t){e.node=t},style:this.state.initialStyle,className:o._children?"nodeBase":"leafNodeBase",transform:this.state.transform,onClick:this.handleOnClick,onMouseOver:this.handleOnMouseOver,onMouseOut:this.handleOnMouseOut},this.renderNodeElement(l),i&&a?t.createElement(h,c({nodeData:o,nodeSize:r},a)):t.createElement(d,c({},this.props,{nodeStyle:l})))},n}(t.Component);f.defaultProps={nodeLabelComponent:null,name:"",attributes:void 0,circleRadius:void 0,styles:{node:{circle:{},name:{},attributes:{}},leafNode:{circle:{},name:{},attributes:{}}}},f.propTypes={nodeData:o.object.isRequired,nodeSvgShape:o.object.isRequired,nodeLabelComponent:o.object,nodeSize:o.object.isRequired,orientation:o.oneOf(["horizontal","vertical"]).isRequired,transitionDuration:o.number.isRequired,onClick:o.func.isRequired,onMouseOver:o.func.isRequired,onMouseOut:o.func.isRequired,name:o.string,attributes:o.object,textLayout:o.object.isRequired,subscriptions:o.object.isRequired,allowForeignObjects:o.bool.isRequired,circleRadius:o.number,styles:o.object};var m=function(e){function n(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this).state={initialStyle:{opacity:0}},t.handleOnClick=function(e){t.props.onClick(t.props.linkData.source,t.props.linkData.target,e)},t.handleOnMouseOver=function(e){t.props.onMouseOver(t.props.linkData.source,t.props.linkData.target,e)},t.handleOnMouseOut=function(e){t.props.onMouseOut(t.props.linkData.source,t.props.linkData.target,e)},t}u(n,e);var o=n.prototype;return o.componentDidMount=function(){this.applyOpacity(1,this.props.transitionDuration)},o.componentWillLeave=function(e){this.applyOpacity(0,this.props.transitionDuration,e)},o.applyOpacity=function(e,t,n){void 0===n&&(n=function(){}),0===t?(r.select(this.link).style("opacity",e),n()):r.select(this.link).transition().duration(t).style("opacity",e).each("end",n)},o.drawStepPath=function(e,t){var n=e.source,o=e.target,r=o.y-n.y;return"horizontal"===t?"M"+n.y+","+n.x+" H"+(n.y+r/2)+" V"+o.x+" H"+o.y:"M"+n.x+","+n.y+" V"+(n.y+r/2)+" H"+o.x+" V"+o.y},o.drawDiagonalPath=function(e,t){return r.svg.diagonal().projection(function(e){return"horizontal"===t?[e.y,e.x]:[e.x,e.y]})(e)},o.drawStraightPath=function(e,t){var n=r.svg.line().interpolate("basis").x(function(e){return e.x}).y(function(e){return e.y}),o=[{x:e.source.x,y:e.source.y},{x:e.target.x,y:e.target.y}];return"horizontal"===t&&(o=[{x:e.source.y,y:e.source.x},{x:e.target.y,y:e.target.x}]),n(o)},o.drawElbowPath=function(e,t){return"horizontal"===t?"M"+e.source.y+","+e.source.x+"V"+e.target.x+"H"+e.target.y:"M"+e.source.x+","+e.source.y+"V"+e.target.y+"H"+e.target.x},o.drawPath=function(){var e=this.props,t=e.linkData,n=e.orientation,o=e.pathFunc;return"function"==typeof o?o(t,n):"elbow"===o?this.drawElbowPath(t,n):"straight"===o?this.drawStraightPath(t,n):"step"===o?this.drawStepPath(t,n):this.drawDiagonalPath(t,n)},o.render=function(){var e=this;return t.createElement("path",{ref:function(t){e.link=t},style:c({},this.state.initialStyle,this.props.styles),className:"linkBase",d:this.drawPath(),onClick:this.handleOnClick,onMouseOver:this.handleOnMouseOver,onMouseOut:this.handleOnMouseOut,"data-source-id":this.props.linkData.source.id,"data-target-id":this.props.linkData.target.id})},n}(t.PureComponent);m.defaultProps={styles:{}},m.propTypes={linkData:o.object.isRequired,orientation:o.oneOf(["horizontal","vertical"]).isRequired,pathFunc:o.oneOfType([o.oneOf(["diagonal","elbow","straight","step"]),o.func]).isRequired,transitionDuration:o.number.isRequired,onClick:o.func.isRequired,onMouseOver:o.func.isRequired,onMouseOut:o.func.isRequired,styles:o.object};var y=function(e){function n(){for(var t,o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).state={dataRef:t.props.data,data:n.assignInternalProperties(a(t.props.data)),d3:n.calculateD3Geometry(t.props),rd3tSvgClassName:"_"+s.v4(),rd3tGClassName:"_"+s.v4()},t.internalState={initialRender:!0,targetNode:null,isTransitioning:!1},t.handleNodeToggle=function(e,o){var r=a(t.state.data),i=t.findNodesById(e,r,[])[0];o.persist(),t.props.collapsible&&!t.state.isTransitioning?(i._collapsed?(n.expandNode(i),t.props.shouldCollapseNeighborNodes&&t.collapseNeighborNodes(i,r)):n.collapseNode(i),t.setState({data:r,isTransitioning:!0},function(){return t.handleOnClickCb(i,o)}),setTimeout(function(){return t.setState({isTransitioning:!1})},t.props.transitionDuration+10),t.internalState.targetNode=i):t.handleOnClickCb(i,o)},t.handleOnClickCb=function(e,n){var o=t.props.onClick;o&&"function"==typeof o&&o(a(e),n)},t.handleOnLinkClickCb=function(e,n,o){var r=t.props.onLinkClick;r&&"function"==typeof r&&(o.persist(),r(a(e),a(n),o))},t.handleOnMouseOverCb=function(e,n){var o=t.props.onMouseOver;if(o&&"function"==typeof o){var r=a(t.state.data),i=t.findNodesById(e,r,[])[0];n.persist(),o(a(i),n)}},t.handleOnLinkMouseOverCb=function(e,n,o){var r=t.props.onLinkMouseOver;r&&"function"==typeof r&&(o.persist(),r(a(e),a(n),o))},t.handleOnMouseOutCb=function(e,n){var o=t.props.onMouseOut;if(o&&"function"==typeof o){var r=a(t.state.data),i=t.findNodesById(e,r,[])[0];n.persist(),o(a(i),n)}},t.handleOnLinkMouseOutCb=function(e,n,o){var r=t.props.onLinkMouseOut;r&&"function"==typeof r&&(o.persist(),r(a(e),a(n),o))},t}u(n,e),n.getDerivedStateFromProps=function(e,t){var o=null;e.data!==t.dataRef&&(o={dataRef:e.data,data:n.assignInternalProperties(a(e.data))});var r=n.calculateD3Geometry(e);return i(r,t.d3)||((o=o||{}).d3=r),o};var o=n.prototype;return o.componentDidMount=function(){this.bindZoomListener(this.props),this.internalState.initialRender=!1},o.componentDidUpdate=function(e){i(this.props.translate,e.translate)&&i(this.props.scaleExtent,e.scaleExtent)&&this.props.zoom===e.zoom&&this.props.transitionDuration===e.transitionDuration||this.bindZoomListener(this.props),"function"==typeof this.props.onUpdate&&this.props.onUpdate({node:this.internalState.targetNode?a(this.internalState.targetNode):null,zoom:this.state.d3.scale,translate:this.state.d3.translate}),this.internalState.targetNode=null},o.setInitialTreeDepth=function(e,t){e.forEach(function(e){e._collapsed=e.depth>=t})},o.bindZoomListener=function(e){var t=this,n=e.zoomable,o=e.scaleExtent,a=e.translate,i=e.zoom,s=e.onUpdate,l=this.state,c=l.rd3tGClassName,u=r.select("."+l.rd3tSvgClassName),p=r.select("."+c);n&&u.call(r.zoom().scaleExtent([o.min,o.max]).on("zoom",function(){p.attr("transform","translate("+r.event.translate+") scale("+r.event.scale+")"),"function"==typeof s&&(s({node:null,zoom:r.event.scale,translate:{x:r.event.translate[0],y:r.event.translate[1]}}),t.state.d3.scale=r.event.scale,t.state.d3.translate={x:r.event.translate[0],y:r.event.translate[1]})}).scale(i).translate([a.x,a.y]))},n.assignInternalProperties=function(e){return(Array.isArray(e)?e:[e]).map(function(e){return e.id=s.v4(),void 0===e._collapsed&&(e._collapsed=!1),e.children&&e.children.length>0&&(e.children=n.assignInternalProperties(e.children),e._children=e.children),e})},o.findNodesById=function(e,t,n){var o=this;return n.length>0||(n=n.concat(t.filter(function(t){return t.id===e})),t.forEach(function(t){t._children&&t._children.length>0&&(n=o.findNodesById(e,t._children,n))})),n},o.findNodesAtDepth=function(e,t,n){var o=this;return n=n.concat(t.filter(function(t){return t.depth===e})),t.forEach(function(t){t._children&&t._children.length>0&&(n=o.findNodesAtDepth(e,t._children,n))}),n},n.collapseNode=function(e){e._collapsed=!0,e._children&&e._children.length>0&&e._children.forEach(function(e){n.collapseNode(e)})},n.expandNode=function(e){e._collapsed=!1},o.collapseNeighborNodes=function(e,t){this.findNodesAtDepth(e.depth,t,[]).filter(function(t){return t.id!==e.id}).forEach(function(e){return n.collapseNode(e)})},o.generateTree=function(){var e=this.props,t=e.initialDepth,n=e.useCollapseData,o=e.depthFactor,a=e.separation,i=e.nodeSize,s=e.orientation,l=r.layout.tree().nodeSize("horizontal"===s?[i.y,i.x]:[i.x,i.y]).separation(function(e,t){return e.parent.id===t.parent.id?a.siblings:a.nonSiblings}).children(function(e){return e._collapsed?null:e._children}),c=this.state.data[0],u=l.nodes(c);return!1===n&&void 0!==t&&this.internalState.initialRender&&(this.setInitialTreeDepth(u,t),u=l.nodes(c)),o&&u.forEach(function(e){e.y=e.depth*o}),{nodes:u,links:l.links(u)}},n.calculateD3Geometry=function(e){return{translate:e.translate,scale:e.zoom>e.scaleExtent.max?e.scaleExtent.max:e.zoom<e.scaleExtent.min?e.scaleExtent.min:e.zoom}},o.render=function(){var e=this,n=this.generateTree(),o=n.nodes,r=n.links,a=this.state,i=a.rd3tSvgClassName,l=a.rd3tGClassName,u=this.props,d=u.nodeSvgShape,h=u.nodeLabelComponent,y=u.orientation,b=u.pathFunc,v=u.transitionDuration,g=u.zoomable,O=u.textLayout,x=u.nodeSize,D=u.circleRadius,C=u.allowForeignObjects,k=u.styles,N=this.state.d3,S=N.translate,M=N.scale,j=c({},x,u.separation,{depthFactor:u.depthFactor,initialDepth:u.initialDepth});return t.createElement("div",{className:"rd3t-tree-container "+(g?"rd3t-grabbable":void 0)},t.createElement("svg",{className:i,width:"100%",height:"100%"},t.createElement(p,{transitionDuration:v,component:"g",className:l,transform:"translate("+S.x+","+S.y+") scale("+M+")"},r.map(function(n){return t.createElement(m,{key:s.v4(),orientation:y,pathFunc:b,linkData:n,onClick:e.handleOnLinkClickCb,onMouseOver:e.handleOnLinkMouseOverCb,onMouseOut:e.handleOnLinkMouseOutCb,transitionDuration:v,styles:k.links})}),o.map(function(n){return t.createElement(f,{key:n.id,nodeSvgShape:c({},d,n.nodeSvgShape),nodeLabelComponent:h,nodeSize:x,orientation:y,transitionDuration:v,nodeData:n,name:n.name,attributes:n.attributes,onClick:e.handleNodeToggle,onMouseOver:e.handleOnMouseOverCb,onMouseOut:e.handleOnMouseOutCb,textLayout:n.textLayout||O,circleRadius:D,subscriptions:j,allowForeignObjects:C,styles:k.nodes})}))))},n}(t.Component);function b(e,t){var n={};return e.forEach(function(e){if(t){var o={};t.forEach(function(t){o[t]=e[t]}),e.attributes=o}var r;e.source=(n[r=e.parent]||(n[r]={name:r}),n[r]),e.target=function(e,t){return n[e]||(n[e]={name:e,attributes:t}),n[e]}(e.child,e.attributes);var a=e.source,i=e.target;a.id=s.v4(),i.id=s.v4(),i.parent=a.name||null,a._collapsed=i._collapsed=!1,a._children?a._children.push(i):a._children=[i]}),[e.filter(function(e){return!e.source.parent})[0].source]}y.defaultProps={nodeSvgShape:{shape:"circle",shapeProps:{r:10}},nodeLabelComponent:null,onClick:void 0,onMouseOver:void 0,onMouseOut:void 0,onLinkClick:void 0,onLinkMouseOver:void 0,onLinkMouseOut:void 0,onUpdate:void 0,orientation:"horizontal",translate:{x:0,y:0},pathFunc:"diagonal",transitionDuration:500,depthFactor:void 0,collapsible:!0,useCollapseData:!1,initialDepth:void 0,zoomable:!0,zoom:1,scaleExtent:{min:.1,max:1},nodeSize:{x:140,y:140},separation:{siblings:1,nonSiblings:2},textLayout:{textAnchor:"start",x:10,y:-10,transform:void 0},allowForeignObjects:!1,shouldCollapseNeighborNodes:!1,circleRadius:void 0,styles:{}},y.propTypes={data:o.oneOfType([o.array,o.object]).isRequired,nodeSvgShape:o.shape({shape:o.string,shapeProps:o.object}),nodeLabelComponent:o.object,onClick:o.func,onMouseOver:o.func,onMouseOut:o.func,onLinkClick:o.func,onLinkMouseOver:o.func,onLinkMouseOut:o.func,onUpdate:o.func,orientation:o.oneOf(["horizontal","vertical"]),translate:o.shape({x:o.number,y:o.number}),pathFunc:o.oneOfType([o.oneOf(["diagonal","elbow","straight","step"]),o.func]),transitionDuration:o.number,depthFactor:o.number,collapsible:o.bool,useCollapseData:o.bool,initialDepth:o.number,zoomable:o.bool,zoom:o.number,scaleExtent:o.shape({min:o.number,max:o.number}),nodeSize:o.shape({x:o.number,y:o.number}),separation:o.shape({siblings:o.number,nonSiblings:o.number}),textLayout:o.object,allowForeignObjects:o.bool,shouldCollapseNeighborNodes:o.bool,circleRadius:o.number,styles:o.shape({nodes:o.object,links:o.object})},n.polyfill(y);var v={__proto__:null,default:{parseCSV:function(e,t){return new Promise(function(n,o){try{r.csv(e,function(e){return n(b(e,t))})}catch(e){o(e)}})},parseJSON:function(e){return new Promise(function(t,n){try{r.json(e,function(e){return t([e])})}catch(e){n(e)}})},parseFlatJSON:function(e,t){return new Promise(function(n,o){try{r.json(e,function(e){return n(b(e,t))})}catch(e){o(e)}})},generateHierarchy:function(e){return b(e)}}};e.Tree=y,e.treeUtil=v});
//# sourceMappingURL=react-d3-tree.umd.js.map
